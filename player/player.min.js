/* thumbsPlayer - v1.0.7 */
!function(e,t,i){e[i]=function(e){var i=[],n=!1,a=.8,s={streaming:"Currently streaming...",paused:"Click play to stream."};this.el=null,this.playing=!1,this.flash=null,this.currentTrack=0;var r={play:null,pause:null,playPause:null,scrubber:null,timeBar:null,streamMsg:null,trackTitle:null,volumeUp:null,volumeDown:null,volume:null,trackAhead:null,trackBack:null};this.enableLog=!1,this.log=function(){"undefined"!=typeof console&&this.enableLog&&console.log(arguments)},this.setTimer=function(){var e=this.getTrack();n&&(r.timeBar.children(".currentTime").html(this.meaningfulTime(e.currentTime)),r.timeBar.children(".totalTime").html(this.meaningfulTime(e.duration)))},this.playAudio=function(){this.playing=!0,this.updateMsg(),this.el.css({"-webkit-animation-play-state":"running","-moz-animation-play-state":"running","-ms-animation-play-state":"running","-o-animation-play-state":"running"}),this.getTrack().play(),this.setVolume(a)},this.pauseAudio=function(){this.playing=!1,this.updateMsg(),this.el.css({"-webkit-animation-play-state":"paused","-moz-animation-play-state":"paused","-ms-animation-play-state":"paused","-o-animation-play-state":"paused"}),this.getTrack().pause()},this.playOrPauseAudio=function(){this.playing?this.pauseAudio():this.playAudio()},this.updateMsg=function(){r.streamMsg&&r.streamMsg.html(this.playing?s.streaming:s.paused)},this.updateTitle=function(){var e=this.getTrack(),t=[];r.trackTitle&&"undefined"!=typeof e.trackInfo&&("undefined"!=typeof e.trackInfo.artist&&t.push(e.trackInfo.artist),"undefined"!=typeof e.trackInfo.title&&t.push('"'+e.trackInfo.title+'"'),"undefined"!=typeof e.trackInfo.album&&t.push("<i>"+e.trackInfo.album+"</i>"),r.trackTitle.html(t.join(" - ")))},this.scrub=function(e){var t,i=r.scrubber.offset(),n=Math.floor((e.pageX-i.left)/r.scrubber.width()*100);return n>100?n=100:0>n&&(n=0),r.scrubber.children("div").css({width:n+"%"}),t=Math.floor(audio.duration*(n/100)),this.setCurrentTimer(t),t},this.seekAudio=function(e){var t=this.getTrack();e>t.duration?e=t.duration:0>e&&(e=0),"function"==typeof t.seek?t.seek(e):t.currentTime=e,n=!0},this.checkBuffering=function(){if(r.playPause){var e=this.getTrack();this.playing&&(e.buffered.start(0)>=e.currentTime||e.buffered.end(0)<=e.currentTime)?r.playPause.removeClass("play").removeClass("pause"):this.playing?r.playPause.removeClass("play").addClass("pause"):r.playPause.addClass("play").removeClass("pause")}},this.updateScrubber=function(){var e=this.getTrack();if(n){var t=Math.floor(e.currentTime/e.duration*100);r.scrubber.children("div").css({width:t+"%"})}},this.setCurrentTimer=function(e){r.timeBar.children(".currentTime").html(this.meaningfulTime(e))},this.meaningfulTime=function(e){var t=0,i=0,n=0;return e>0&&(n=Math.round(e%60)),e>=60&&(i=Math.floor(e/60%60)),e>=3600&&(t=Math.floor(e/3600%3600)),10>n&&(n="0"+n),10>i&&(i="0"+i),t+":"+i+":"+n},this.meaningfulToSeconds=function(e){for(var t=e.split(":").reverse(),i=0,n=0;n<t.length;n++)0==n?i+=parseInt(t[n]):1==n?i+=60*parseInt(t[n]):2==n&&(i+=3600*parseInt(t[n]));return i},this.adjustVolume=function(e){return(Math.exp(e)-1)/(Math.E-1)},this.setVolume=function(e){e>1?e=1:0>e&&(e=0),this.log("volume: "+e),a=e,this.playing&&(this.getTrack().volume=this.adjustVolume(e),this.log("real volume: "+this.getTrack().volume),"function"==typeof this.getTrack().setVolume&&this.getTrack().setVolume())},this.stepVolume=function(e){var t=.1*e;this.setVolume(a+t)},this.changeTrack=function(e){"undefined"!=typeof i[e]&&(this.playing?(this.pauseAudio(),this.seekAudio(0),this.currentTrack=e,this.seekAudio(0),this.playAudio()):this.playAudio(),this.setTrackButtons(),this.updateTitle())},this.getTrack=function(){return i[this.currentTrack]},this.setTrackButtons=function(){r.trackAhead&&(this.currentTrack>=i.length-1?r.trackAhead.addClass("disabled"):r.trackAhead.removeClass("disabled")),r.trackBack&&(this.currentTrack<=0?r.trackBack.addClass("disabled"):r.trackBack.removeClass("disabled"))},this.jPlayerLoaded=!1,this.jPlayerBridge=function(e,i){var n=this,a=!1,s=t(e).children("source");this.src=s.attr("src"),this.runtime=s.data("runtime"),this.player=t("<div />").addClass("jplayer"),this.duration=this.runtime?this.runtime:0,this.currentTime=0,this.bufferedStart=0,this.bufferedEnd=0,t(i.el).append(this.player),this.player.jPlayer({ready:function(){n.init(),i.addListeners(n)},swfPath:"../player/jplayer/jplayer.swf",solution:"html, flash"}),this.addEventListener=function(e,i){n.player.bind(t.jPlayer.event[e],i)},this.init=function(){a=!0,n.addEventListener("timeupdate",function(e){n.currentTime=e.jPlayer.status.currentTime}),n.addEventListener("progress",function(e){(!n.runtime||e.jPlayer.status.duration>n.duration)&&(n.duration=e.jPlayer.status.duration),n.bufferedEnd=e.jPlayer.status.duration}),n.player.jPlayer("setMedia",{mp3:n.src})},this.play=function(e){return a?(n.player.jPlayer("play",e),!0):!1},this.pause=function(e){"undefined"!=typeof e?n.player.jPlayer("pause",e):n.player.jPlayer("pause")},this.seek=function(e){i.playing?n.play(e):n.pause(e)},this.buffered={start:function(){return n.bufferedStart},end:function(){return n.bufferedEnd}},this.volume=null,this.setVolume=function(){n.player.jPlayer("volume",this.volume)}},this.addListeners=function(e){var t=this;e.addEventListener("durationchange",function(){t.setTimer()}),e.addEventListener("timeupdate",function(){t.setTimer(),t.updateScrubber()}),e.addEventListener("play",function(){t.log("play"),r.playPause.addClass("play").removeClass("pause")}),e.addEventListener("pause",function(){t.log("pause"),r.playPause.removeClass("pause").addClass("play")}),e.addEventListener("ended",function(){t.pauseAudio()}),e.addEventListener("loadedmetadata",function(){if(window.location.hash){for(var e=window.location.hash.substr(1).split("|"),i=!1,n=0;n<e.length;n++)"playing"==e[n]?i=!0:(seconds=t.meaningfulToSeconds(e[n]),t.seekAudio(seconds));i&&t.playAudio()}})},this.applySettings=function(e){if(this.el=t(e.selector),!this.el.length)return!1;if("undefined"!=typeof e.logging&&(this.enableLog=e.logging),"undefined"!=typeof e.messages)for(var n in e.messages)e.messages.hasOwnProperty(n)&&(s[n]=s[n]);if("undefined"!=typeof e.initVolume&&(this.volume=e.initVolume),this.el.find("audio").length)i=this.el.find("audio");else if("undefined"!=typeof e.audio&&e.audio.length)for(var a=0;a<e.audio.length;a++){var r=new Audio;r.src=e.audio[a].file,"undefined"!=typeof e.audio[a].type&&(r.type=e.audio[a].type),"undefined"!=typeof e.audio[a].trackInfo&&(r.trackInfo=e.audio[a].trackInfo),r.load(),i.push(r)}for(var u,a=0;a<i.length;a++)if(u=i[a].canPlayType(i[a].type),"maybe"==u||"probably"==u)this.addListeners(i[a]);else{var l=new this.jPlayerBridge(i[a],this);i[a]=l}return!0},function(e,i){if(i.applySettings(e)){if(i.currentTrack=0,i.el.find(".controlSingle").length&&(r.playPause=i.el.find(".controlSingle"),r.playPause.addClass("play"),r.playPause.click(function(){return i.playOrPauseAudio(i),!1})),i.el.find(".scrubber").length){r.scrubber=i.el.find(".scrubber");var a=t("<div />").css({width:"0%"}).appendTo(r.scrubber);t("<span />").appendTo(a),n=!0;var s=0;r.scrubber.bind("mousedown",function(e){i.log("scrub: click"),n=!1,s=i.scrub(e),r.scrubber.bind("mousemove",function(e){i.log("scrub: scrub scrub"),s=i.scrub(e)}),r.scrubber.bind("mouseleave",function(){i.log("scrub: leave (play)"),i.seekAudio(s),r.scrubber.unbind("mousemove").unbind("mouseleave").unbind("mouseup")}),r.scrubber.bind("mouseup",function(){i.log("scrub: let go (play)"),i.seekAudio(s),r.scrubber.unbind("mousemove").unbind("mouseleave").unbind("mouseup")})})}i.el.find(".timeBar").length&&(r.timeBar=i.el.find(".timeBar")),i.el.find(".streamMsg").length&&(r.streamMsg=i.el.find(".streamMsg"),i.updateMsg()),i.el.find(".volumeUp").length&&(r.volumeUp=i.el.find(".volumeUp"),r.volumeUp.bind("click",function(){i.log("click: volume up"),i.stepVolume(1)})),i.el.find(".volumeDown").length&&(r.volumeDown=i.el.find(".volumeDown"),r.volumeDown.bind("click",function(){i.log("click: volume down"),i.stepVolume(-1)})),i.el.find(".trackAhead").length&&(r.trackAhead=i.el.find(".trackAhead"),r.trackAhead.bind("click",function(){i.log("click: skip track"),i.changeTrack(i.currentTrack+1)})),i.el.find(".trackBack").length&&(r.trackBack=i.el.find(".trackBack"),r.trackBack.bind("click",function(){i.log("click: back track"),i.changeTrack(i.currentTrack-1)})),i.el.find(".audioTitle").length&&(r.trackTitle=i.el.find(".audioTitle"),i.updateTitle()),i.el.find(".volume").length&&(r.volume=i.el.find(".volume")),i.playerInt=setInterval(function(){i.checkBuffering()},100),i.setTrackButtons(),"undefined"!=typeof e.autoPlay&&e.autoPlay&&i.playAudio()}}(e,this)}}(this,jQuery,"ThumbsPlayer");
